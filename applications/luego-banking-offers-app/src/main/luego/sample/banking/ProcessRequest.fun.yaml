---
imports:
  - luego.list.*
  - sample.banking.*
  - sample.banking.validation.*
  - sample.banking.eligibility.*
  - sample.banking.offers.*

usedDecisions: 
  - sample.banking.validation.ValidateRequest
  - sample.banking.eligibility.AssessEligibility
  - sample.banking.offers.CalculateSpecialOffer

exposable: true
output: 'sample.banking.Response'
inputs:
  - name: the request
    type: 'sample.banking.Request'
  - name: the customer
    type: 'sample.banking.Person'
    
definition: >
  depending on ValidateRequest(`the request`, `the customer`) {
    case errors: NonEmptyList[Text] => InvalidRequest(errors = errors)
    case Nil => 
      depending on AssessEligibility(`the request`, `the customer`) {
        case rejections: NonEmptyList[Text] => NoDiscount(reasons = rejections)
        case Nil => CalculateSpecialOffer(`the request`, `the customer`)
      }
  }